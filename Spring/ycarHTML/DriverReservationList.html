<!DOCTYPE html>
<html>

<head>
    <title>리스트 출력</title>
</head>
<style>
   /* #year{
        text-align: center;
    }
    #pastbutton{
        display: inline;
    }
    #listdiv{
        text-align: center;
    }*/
    /*#pastList{
        float: right;
    }*/
</style>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://apis.openapi.sk.com/tmap/js?version=1&format=javascript&appKey=61f9f7ec-2010-4d26-97e1-806dc10dce63"></script>
<script>
    $(document).ready(function(){
        
    
   
    $('#future').append(future);

        //리스트 none
        $('#todayList').css('display','none');
        $('#futureList').css('display','none');
        $('#pastList').css('display','none');
        
        
        
        function list() {
            
             var d = new Date();
    
            var thisyear = d.getFullYear() + "년";  

            //오늘
            var today = (d.getMonth() + 1) + "/" + d.getDate();

            //과거
            var past = "~" + (d.getMonth() + 1) + "/" + (d.getDate()-1);

            //미래
            var future = (d.getMonth() + 1) + "/" + (d.getDate()+1) + "~";

           var thisday =   d.getFullYear() +"/"+ "0"+ (d.getMonth() + 1) +"/"+ d.getDate();

            $('#thisyear').append(thisyear);
            $('#past').append(past);
            $('#today').append(today);
             $('#future').append(future);
            
            
                
            
            
           

        $.ajax({
            url: 'http://localhost:8080/reservation/rvInsert/' + 2,
            type: 'GET',
            success: function(data) {
                
                var pasthtml = '';
                var todayhtml = '';
                var futurehtml = '';
                var count = 0;
            
                
                var pastlist = data.past;
                var todaylist = data.today;
                var futurelist = data.future;
                
                
                //과거
            for(var i=0; i<pastlist.length; i++){
                    
                pasthtml += '날짜 : ' + pastlist[i].d_date +' <br>\n';
                pasthtml += '출발시간 : ' + pastlist[i].d_startTime +' <br>\n';
                pasthtml += '도착시간 : ' + pastlist[i].d_endTime +' <br>\n';
                pasthtml += pastlist[i].d_commute +'<br>\n';
                pasthtml += '출발장소 : ' + pastlist[i].d_startPoint +' <br>\n';
                pasthtml += '도착장소 : ' + pastlist[i].d_endPoint +' <br>\n';
                 pasthtml += '요금 : ' + pastlist[i].d_fee +' <br>\n';
                pasthtml += '<button id="pastbutton" onclick="map('+ pastlist[i].d_startlon+', '+ pastlist[i].d_startlat+', ' + pastlist[i].d_endlon+', ' + pastlist[i].d_endlat +')">지도보기</button>';
                pasthtml += '<button onclick="mapclose('+(count+1)+')">닫기</button>'+' <br>\n';
                 
               
              pasthtml += '<button onclick="deleteData('+pastlist[i].dr_idx+')">삭제하기</button>'+'<br><br>\n';   
                
                
            }
                //현재
                for(var i=0; i<todaylist.length; i++){
                    
                todayhtml += '날짜 : ' + todaylist[i].d_date +' <br>\n';
                todayhtml += '출발시간 : ' + todaylist[i].d_startTime +' <br>\n';
                todayhtml += '도착시간 : ' + todaylist[i].d_endTime +' <br>\n';
                todayhtml += todaylist[i].d_commute +'<br>\n';
                todayhtml += '출발장소 : ' + todaylist[i].d_startPoint +' <br>\n';
                todayhtml += '도착장소 : ' + todaylist[i].d_endPoint +' <br>\n';
                    todayhtml += '요금 : ' + todaylist[i].d_fee +' <br>\n';
                todayhtml += '<button id="todaybutton" onclick="map('+ todaylist[i].d_startlon +', '+ todaylist[i].d_startlat+', '+ todaylist[i].d_endlon+', '+ todaylist[i].d_endlat+','+count+')">지도보기</button>'+'\n';
                todayhtml += '<button onclick="mapclose('+(count+1)+')">닫기</button>'+' <br>\n';
                    todayhtml += '<div id="map_div"></div>'+'<br><br>\n';
                
               todayhtml += '<button onclick="deleteData('+todaylist[i].dr_idx+')">삭제하기</button>+'+'<br><br>\n';      
                
            }
                //미래
                for(var i=0; i<futurelist.length; i++){
                    
                futurehtml += '날짜 : ' + futurelist[i].d_date +' <br>\n';
                futurehtml += '출발시간 : ' + futurelist[i].d_startTime +' <br>\n';
                futurehtml += '도착시간 : ' + futurelist[i].d_endTime +' <br>\n';
                futurehtml += futurelist[i].d_commute +'<br>\n';
                futurehtml += '출발장소 : ' + futurelist[i].d_startPoint +' <br>\n';
                futurehtml += '도착장소 : ' + futurelist[i].d_endPoint +' <br>\n';
                    futurehtml += '요금 : ' + futurelist[i].d_fee +' <br>\n';
                futurehtml += '<button id="futurebutton" onclick="map('+ futurelist[i].d_startlon+', ' + futurelist[i].d_startlat+', ' + futurelist[i].d_endlon+', '+futurelist[i].d_endlat+','+count+')">지도 보기</button>'+'\n';
                futurehtml += '<button onclick="mapclose('+(count+1)+')">닫기</button>'+' <br>\n';
                    futurehtml += '<div id="map_div"></div>'+'<br><br>\n';
                
                futurehtml += '<button onclick="deleteData('+futurelist[i].dr_idx+')">삭제하기</button>'+'<br><br>\n';     
                
            }
                
                
                 $('#pastList').html(pasthtml);    
                $('#todayList').html(todayhtml);  
                $('#futureList').html(futurehtml);  
                
            }

        });

        return false;

    };
        
        
        
      
        
        //날짜 버튼 클릭시 디스플레이
    $('#past').click(function(){
        $('#pastList').css('display','inline');
       $('#todayList').css('display','none');
        $('#futureList').css('display','none');
        //버튼활성
        $('#pastbutton').css('display','block');
            $('#todaybutton').css('display','block');
            $('#futurebutton').css('display','block');
        
    });
        
        $('#today').click(function(){
            $('#todayList').css('display','inline');
       $('#pastList').css('display','none');
        $('#futureList').css('display','none');
            //버튼활성
            $('#pastbutton').css('display','block');
            $('#todaybutton').css('display','block');
            $('#futurebutton').css('display','block');
    });
        
        $('#future').click(function(){
             $('#futureList').css('display','inline');
       $('#pastList').css('display','none');
        $('#todayList').css('display','none');
            //버튼활성
            $('#pastbutton').css('display','block');
            $('#todaybutton').css('display','block');
            $('#futurebutton').css('display','block');
    });
        
      list();  
     });   
        
        
        
          function mapclose(count){
                /*map.destroy();*/
            
            alert('닫기' + count);
                 $('#map_div').remove();
                 $('#pastbutton').css('display','block');
                 $('#todaybutton').css('display','block');
                 $('#futurebutton').css('display','block');
            
            return count;
             };
        
        
    
    
        function map(d_startlon,d_startlat,d_endlon,d_endlat,count){
            
            alert(count);
            
            if(count == 1){
               var html = '<div id="map_div"></div>';

                $('#mapmap').append(html);
               }
            
            $('#pastbutton').css('display','none');
            $('#todaybutton').css('display','none');
            $('#futurebutton').css('display','none');
            
            /*alert("지도보기용 lonlat" + d_startlon +"  "+ d_startlat +"  "+ d_endlon +"  "+ d_endlat);*/
            
           var map;
            
           
	   
            // 페이지가 로딩이 된 후 호출하는 함수입니다.
    
           
       
		// map 생성
		// Tmap.map을 이용하여, 지도가 들어갈 div, 넓이, 높이를 설정합니다.
		map = new Tmap.Map({div:'map_div', width:'200px', height:'200px'});
		var tData = new Tmap.TData();//REST API 에서 제공되는 경로, 교통정보, POI 데이터를 쉽게 처리할 수 있는 클래스입니다.
		
		var s_lonLat = new Tmap.LonLat(d_startlon, d_startlat); //시작 좌표입니다.   
		var e_lonLat = new Tmap.LonLat(d_endlon, d_endlat); //도착 좌표입니다.
		var optionObj = {
				reqCoordType:"WGS84GEO", //요청 좌표계 옵셥 설정입니다.
				resCoordType:"EPSG3857"  //응답 좌표계 옵셥 설정입니다.
             }
		
		tData.getRoutePlan(s_lonLat, e_lonLat, optionObj);//경로 탐색 데이터를 콜백 함수를 통해 XML로 리턴합니다.
		
		tData.events.register("onComplete", tData, onComplete);//데이터 로드가 성공적으로 완료되었을 때 발생하는 이벤트를 등록합니다.
		tData.events.register("onPrnError", tData, onError);//데이터 로드가 실패했을 떄 발생하는 이벤트를 등록합니다.
           
           /*$('#map_div').append(map);*/
            
        
	   
	
	   //데이터 로드가 성공적으로 완료되었을 때 발생하는 이벤트 함수 입니다. 
	   function onComplete(){
		console.log(this.responseXML); //xml로 데이터를 받은 정보들을 콘솔창에서 확인할 수 있습니다.
			      
		var kmlForm = new Tmap.Format.KML({extractStyles:true}).read(this.responseXML);
		var vectorLayer = new Tmap.Layer.Vector("vectorLayerID");
		vectorLayer.addFeatures(kmlForm);
		map.addLayer(vectorLayer);
		//경로 그리기 후 해당영역으로 줌  
		map.zoomToExtent(vectorLayer.getDataExtent());
               }
             
           
             
            //데이터 로드중 발생하는 이벤트 함수입니다.
            function onProgress(){
                //alert("onComplete");
            }
            //데이터 로드시 에러가 발생시 발생하는 이벤트 함수입니다.
            function onError(){
                alert("오류가 발생했습니다. 죄송합니다.");
            }
    
           
                }
    
    //삭제
    function deleteData(dr_idx){
        
        alert(dr_idx);
        
         $.ajax({
            url: 'http://localhost:8080/reservation/rvInsert/' + dr_idx,
            type: 'DELETE',
            success: function(data) {
                if(data != null){
                     alert('정상적으로 삭제되었습니다.');
                    list();
                    
                }else{
                    alert('오류가 발생하였습니다.');
                }
                    
            }
             
             
             
             
         });
        
    }
    
            
          
        
    
    
        
    
    
    
</script>
<body>
   <div id="year">
   <button id="past"></button>
   <button id="today"></button>
    <button id="future"></button>
    </div>
    <div id="listdiv">
    <br>
    
    <div id="pastList"></div>
    <div id="todayList"></div>
    <div id="futureList"></div>
    <div id="mapmap"></div>
    <div id="map_div"></div>
    
    </div>
    
</body>
    

</html>
